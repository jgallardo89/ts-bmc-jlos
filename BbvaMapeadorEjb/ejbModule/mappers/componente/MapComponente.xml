<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mappers.componente.MapComponente">
	<select id="obtenerComponentes" parameterType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO"
		resultType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO">
		SELECT C.CD_PANTALLA idPantalla,
		  C.CD_COMPONENTE idComponente,
		  C.Nb_Componente nombreComponente,
		  C.Cd_Tp_Componen idtipoComponente,
		  C.Cd_Default idDefault,
		  Tp.Nb_Tp_Componen nombreTipoComponente,
		  P.NB_PANTALLA nombrePantalla
		FROM Tgm502_Componente C,
		  Tgm501_Pantalla P,
		  Tgm506_Tp_Componen Tp
		WHERE C.Cd_Pantalla   = P.Cd_Pantalla
		AND Tp.Cd_Tp_Componen = C.Cd_Tp_Componen	
			<if test="idPantalla != null  and idPantalla != 0">
				AND C.CD_PANTALLA = #{idPantalla}
			</if>						  
			<if test="nombreComponente != null ">
				AND  C.NB_COMPONENTE LIKE #{nombreComponente}
			</if>			
			<if test="idTipoComponente != 0 and idTipoComponente != null">
				AND  C.TP_COMPONENTE LIKE #{idTipoComponente}
			</if>	
				ORDER BY C.CD_COMPONENTE
	</select>
	<insert id="crearComponente" keyProperty="idComponente" parameterType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO">
		<selectKey keyProperty="idComponente" resultType="int" order="BEFORE"> 
			<![CDATA[ select SQ_COMPONENTE.nextval as idComponente from dual ]]> 
		</selectKey>
			INSERT INTO TGM502_COMPONENTE (
				CD_COMPONENTE, 
				CD_PANTALLA, 
				NB_COMPONENTE, 
				CD_TP_COMPONEN, 
				CD_DEFAULT) VALUES (
				#{idComponente},
				#{idPantalla}, 
				#{nombreComponente}, 
				#{idTipoComponente},
				' ')
	</insert>
	<select id="obtenerComponentesPantalla" parameterType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO"
		resultType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO">					
		Select Componente.Cd_Pantalla idPantalla,
		Componente.Cd_Componente idComponente,
		Componente.Nb_Componente nombreComponente,		
		Componente.Cd_Default idDefault
		From Tgm502_Componente Componente    
		Where Componente.Cd_Default = 'F'    
		And Componente.Cd_Pantalla = #{idPantalla}
		minus      
		Select Componente.Cd_Pantalla idPantalla,
		Componente.Cd_Componente idComponente,
		Componente.Nb_Componente nombreComponente,		
		Componente.Cd_Default idDefault
		From Tgm502_Componente Componente,
    	tgm505_ctrlpermiso control
		Where Componente.Cd_Default = 'F'    
		And Componente.Cd_Pantalla = #{idPantalla}
		And Control.Cd_Perfil = #{idPerfil}
    	And Control.Cd_Componente = componente.cd_componente    
	</select>
	<select id="obtenerComponentesPantallaPerfil" parameterType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO"
		resultType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO">	
		Select Componente.Cd_Pantalla idPantalla,
		Componente.Cd_Componente idComponente,
		Componente.Nb_Componente nombreComponente,		
		Componente.Cd_Default idDefault
		From Tgm502_Componente Componente,
    	tgm505_ctrlpermiso control
		Where Componente.Cd_Default = 'F'    		
    	And Control.Cd_Componente = componente.cd_componente
    	And Componente.Cd_Pantalla = #{idPantalla}
    	And Control.Cd_Perfil = #{idPerfil}
	</select>
	<update id="actualizarComponente" parameterType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO">
		UPDATE TGM502_COMPONENTE SET  
			CD_PANTALLA = #{idPantalla}, 
			NB_COMPONENTE = #{nombreComponente}, 
			CD_TP_COMPONEN = #{idTipoComponente}
		WHERE 
			CD_COMPONENTE = #{idComponente}
	</update>
	<delete id="eliminarComponente" parameterType="mx.com.bbva.bancomer.bussinnes.model.vo.ComponenteVO">
		DELETE FROM TGM502_COMPONENTE WHERE CD_COMPONENTE = #{idComponente}
	</delete>
</mapper>